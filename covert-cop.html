<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Covert Cop Project</title>
	<meta name="description" content="Unity stealth platform game">

	<!-- Bootstrap CSS -->
	<link href="./css/bootstrap.min.css" rel="stylesheet">
	<!-- Font Awesome -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<!-- Prism JS -->
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/atom-one-dark.min.css">
	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css?family=Raleway:300,400,500,700,900" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
	<!-- owl carousel css-->
	<link rel="stylesheet" href="./css/owl.carousel.min.css">
	<link rel="stylesheet" href="./css/owl.theme.default.min.css">
	<!-- magnific-popup CSS -->
	<link rel="stylesheet" href="./css/magnific-popup.css">
	<!-- YouTubePopUp CSS -->
	<link rel="stylesheet" href="./css/bicon.min.css" />
	<link rel="stylesheet" href="./css/YouTubePopUp.css">
	<!-- Animate CSS -->
	<link rel="stylesheet" href="./css/animate.css">
	<!-- custom styles (optional) -->
	<link href="./css/style.css" rel="stylesheet">
	<link href="./css/responsive.css" rel="stylesheet">
</head>

<body>
	<!--Loader-->
	<div id="loader">
		<div id="loading-center">
			<div id="loading-center-absolute">
				<div class="object"></div>
				<div class="object"></div>
				<div class="object"></div>
				<div class="object"></div>
				<div class="object"></div>
				<div class="object"></div>
				<div class="object"></div>
				<div class="object"></div>
				<div class="object"></div>
				<div class="object"></div>
			</div>
		</div>
	</div>
	<!-- Loader end -->
	<!-- ====== Navgition ======  -->
	<nav class="navbar navbar-expand-lg fixed-top">
		<div class="container">
			<!-- Logo -->
			<a class="navbar-brand pt-0 logo" href="#">
				<img src="./img/game-programmer-logo.png" alt="Game Programmer Logo" class="logo-1">
				<img src="./img/game-developer-logo.png" alt="Game Developer Logo" class="logo-2">
			</a>
			<!-- // Logo -->

			<!-- Mobile Menu -->
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-expanded="false"><span><i class="fa fa-bars"></i></span></button>
			<!-- Mobile Menu -->

			<div class="collapse navbar-collapse main-menu" id="navbarSupportedContent">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item"><a class="nav-link" href="./">Home</a></li>
					<li class="nav-item"><a class="nav-link" href="./#about">About</a></li>
					<li class="nav-item"><a class="nav-link" href="./#resume">Resume</a></li>
					<li class="nav-item"><a class="nav-link" href="./#skills">Skills</a></li>
					<li class="nav-item active"><a class="nav-link" href="./#portfolio">Portfolio</a></li>
					<li class="nav-item"><a class="nav-link" href="./#contact">Contact</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- ====== End Navgition ======  -->
	<!-- HEADER -->
	<div class="port-hero overlay">
		<div class="container">
			<div class="col-md-12">
				<h2>Covert Cop</h2>
				<div class="breadcroumb">
					Unity
				</div>
			</div>
		</div>
	</div>
	<!-- END HEADER -->
	<!-- single portfolio section start -->
	<div class="single-portfolio section-padding">
		<div class="container">
			<div class="row">
				<div class="col-md-6">
					<div class="owl-carousel owl-theme">
						<div class="item-portfolio">
							<img src="./img/portfolio/covert-cop-camera.jpg" alt="Covert Cop camera" />
						</div>
						<div class="item-portfolio">
							<img src="./img/portfolio/covert-cop-computer.jpg" alt="Covert Cop computer" />
						</div>
						<div class="item-portfolio">
							<img src="./img/portfolio/covert-cop-enemy.jpg" alt="Covert Cop enemy" />
						</div>
						<div class="item-portfolio">
							<img src="./img/portfolio/covert-cop-laser.jpg" alt="Covert Cop laser" />
						</div>
						<div class="item-portfolio">
							<img src="./img/portfolio/covert-cop-saw.jpg" alt="Covert Cop saw" />
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<div class="project-meta-wrapper">
						<h4 class="sub-tit">Project Overview</h4>
						<ul class="single-project-meta">
							<li>
								<i class="fa fa-cube"></i><span>Project Type:</span> Unity 2D Game
							</li>
							<li>
								<i class="fa fa-users"></i><span>Team Size:</span> 4
							</li>
							<li>
								<i class="fa fa-user"></i><span>Role: </span> Game Programmer
							</li>
							<li>
								<i class="fa fa-desktop"></i><span>Software:</span> Unity & VS Code
							</li>
							<li>
								<i class="fa fa-code"></i><span>Languages:</span> C#
							</li>
							<li>
								<i class="fa fa-link"></i><span>Download link:</span> <a href="https://www.dropbox.com/s/lcbgfll4o2dgd5z/Covert-Cop.zip?dl=0" target="_blank">Play Game</a>
							</li>
						</ul>
					</div>
				</div>
				<div class="col-md-12">
					<div class="single-project-description">
                        <h4 class="sub-tit">Project Brief</h4>
                        <p>
                            Covert Cop is a 2D side-scrolling stealth platformer game where you play as an undercover agent trying to expose an evil organization by exploring their compound and hack into their systems without being seen.
                            <br>
                            Being the only programmer in the team I took charge of translating design specs into a functional game. My tasks and achievements include:
                        </p>
                        <br>
                        <h4 class="sub-tit">Responsibilities/Achievements</h4>
                        <ul>
                            <li>- Simulate enemies' field of view by dynamically create meshes to mimic where they could spot the player</li>
                            <li>- Develop tools that allow the design team to create levels and environmental hazards through the game</li>
                            <li>- Program player and enemies movement mechanics</li>
                            <li>- Code user interfaces for the menus and heads-up display</li>
                            <li>- Implement camera behaviour, music and SFX</li>
                            <li>- Implemented 2D animations for the player and enemies using Unity's animation state machine</li>
                        </ul>
                        <h4 class="sub-tit">Code Samples</h4>
						<div id="accordion">
							<div class="card">
								<div class="card-header" id="headingOne">
									<h5 class="mb-0">
										<button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
											Field of View Class
										</button>
									</h5>
								</div>
								<div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
									<div class="card-body">
										<pre><code class="cs">
/*
* Carlos Adan Cortes De la Fuente
* All rights reserved. Copyright (c)
* Email: dev@carlosadan.com
*/

public class FieldOfView : MonoBehaviour 
{

    #region Global Variables

    private IEnumerator currentState;
    private LayerMask playerMask;
    private LayerMask obstaclesMask;

    [SerializeField]
    private bool debugMode = true;
    [SerializeField]
    private float viewRadius;
    [SerializeField]
    [Range(0, 360)]
    private float viewAngle;
    [SerializeField]
    private float meshResolution = 0.5f;

    // Used a mesh to join all the points in space that form the FOV
    private struct MeshRaycastInfo 
    {
        public bool hit;
        public Vector3 point;
        public float distance;
        public float angle;

        public MeshRaycastInfo(bool bHit, Vector3 vPoint, float fDist, float fAngle)
        {
            hit = bHit;
            point = vPoint;
            distance = fDist;
            angle = fAngle;
        }
    }
    private MeshFilter meshFilter;
    private Mesh mesh;
    private List&lt;Vector3> pointList;

    #endregion

    #region Unity Functions

    void Awake () 
    {
        playerMask = LayerMask.GetMask("Player");
        obstaclesMask = LayerMask.GetMask("Default");

        // Init Mesh
        pointList = new List&lt;Vector3>();
        mesh = new Mesh();
        mesh.name = "Field Mesh";
        meshFilter = GetComponent&lt;MeshFilter>();
        meshFilter.mesh = mesh;

        SetState(StateFindPlayer(0.1f));
    }

    void LateUpdate() 
    {
        DrawFieldOfView();
    }

    // Debug code for designers
    void OnDrawGizmos()
    {
        if(debugMode)
        {
            Gizmos.color = Color.green;
            Gizmos.DrawWireSphere(transform.position, viewRadius);
            Gizmos.color = Color.blue;
            Gizmos.DrawRay(transform.position, DirectionFromAngle(transform.eulerAngles.y));
            Gizmos.color = Color.cyan;
            Gizmos.DrawRay(transform.position, DirectionFromAngle(-viewAngle / 2));
            Gizmos.DrawRay(transform.position, DirectionFromAngle(viewAngle / 2));
        }
    }

    #endregion

    #region Class Methods

    private Vector3 DirectionFromAngle (float angle)
    {
        angle -= transform.eulerAngles.z; 	// Adapts the rotation angle to the z rotation of the game object
        Vector3 direction = new Vector3(Mathf.Sin(angle * Mathf.Deg2Rad), Mathf.Cos(angle * Mathf.Deg2Rad), 0);
        return direction * viewRadius;		// Adds the magnitude of the vector depending on the radius
    }

    private void FindPlayer()
    {
        Collider2D playerCollider = Physics2D.OverlapCircle(transform.position, Mathf.Abs(viewRadius), playerMask);
        // Player is inside the radius
        if(playerCollider != null)
        {
            // Get The player collider (he uses a box collider)
            Vector3 colliderPos = playerCollider.bounds.center;
            Vector3 extents = playerCollider.bounds.extents;
            Vector3[] bounds = {
                new Vector3(colliderPos.x + extents.x, colliderPos.y + extents.y, 0f),
                new Vector3(colliderPos.x + extents.x, colliderPos.y - extents.y, 0f),
                new Vector3(colliderPos.x - extents.x, colliderPos.y + extents.y, 0f),
                new Vector3(colliderPos.x - extents.x, colliderPos.y - extents.y, 0f)
            };

            foreach (Vector3 colPos in bounds)
            {
                Vector3 dirToPlayer = (colPos - transform.position).normalized;
                if(Vector3.Angle(DirectionFromAngle(0), dirToPlayer) < viewAngle / 2)
                {
                    // Checks if there are any obstacles
                    float distanceToPlayer = Vector3.Distance(transform.position, colPos);
                    if(!Physics2D.Raycast(transform.position, dirToPlayer, distanceToPlayer, obstaclesMask) && distanceToPlayer <= viewRadius)
                    {
                        if(debugMode)
                        {
                            Debug.DrawLine(transform.position, colliderPos, Color.magenta);
                        }
                        AudioManager.Instance.Play("PlayerCaught");
                        GameManager.Instance.KillPlayer();
                    }
                }
            }
        }
    }

    private void DrawFieldOfView()
    {
        int rayCount = Mathf.RoundToInt(viewAngle * meshResolution);
        float angleSize = viewAngle / rayCount;

        pointList.Clear();
        for(int i = 0; i < rayCount; i++)
        {
            float angle = transform.eulerAngles.y - viewAngle / 2 + angleSize * i;
            MeshRaycastInfo newMRI = CreateMeshRay(angle);
            pointList.Add(newMRI.point);
            // Debug.DrawLine(transform.position, transform.position + DirectionFromAngle(angle), Color.red);
        }

        CreateFieldOfViewMesh();
    }

    private MeshRaycastInfo CreateMeshRay(float angle)
    {		
        Vector3 direction = DirectionFromAngle(angle);
        RaycastHit2D hit = Physics2D.Raycast(transform.position, direction, viewRadius, obstaclesMask);
        if(hit)
        {
            return new MeshRaycastInfo(true, hit.point, hit.distance, angle);
        }
        else
        {
            return new MeshRaycastInfo(false, transform.position + direction, viewRadius, angle);
        }
    }

    private void CreateFieldOfViewMesh()
    {
        int vertexCount = pointList.Count + 1; // We add the origin vertex
        Vector3[] vertices = new Vector3[vertexCount];
        int[] triangles = new int[(vertexCount - 2) * 3];

        vertices[0] = Vector3.zero;
        for (int i = 0; i < vertexCount - 1; i++)
        {
            vertices[i + 1] = transform.InverseTransformPoint(pointList[i]);
            if(i < vertexCount - 2)
            {
                triangles[i * 3] = 0;
                triangles[i * 3 + 1] = i + 1;
                triangles[i * 3 + 2] = i + 2;
            }
        }
        
        mesh.Clear();
        mesh.vertices = vertices;
        mesh.triangles = triangles;
        mesh.RecalculateNormals();
    }

    #endregion

    #region State Machine

    private void SetState(IEnumerator state)
    {
        if(currentState != null)
        {
            StopCoroutine(currentState);
        }
        currentState = state;
        StartCoroutine(currentState);
    }

    IEnumerator StateFindPlayer(float delay) // The delay is for performance 
    {
        while(true)
        {
            yield return new WaitForSeconds(delay);
            FindPlayer();
        }
    }

    #endregion
}
										</code></pre>
									</div>
								</div>
							</div>
							<div class="card">
								<div class="card-header" id="headingOne">
									<h5 class="mb-0">
										<button class="btn btn-link" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
											Laser Class
										</button>
									</h5>
								</div>
								<div id="collapseTwo" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
									<div class="card-body">
										<pre><code class="cs">
/*
* Carlos Adan Cortes De la Fuente
* All rights reserved. Copyright (c)
* Email: dev@carlosadan.com
*/

[RequireComponent(typeof(LineRenderer))]
public class Laser : MonoBehaviour 
{
    #region Properties

    private LineRenderer line;
    private Transform start;
    private Transform end;
    private AudioSource audioSrc;

    private RaycastHit2D hit;

    [Header("Laser Randomnes")]
    [SerializeField]
    private float laserStrength = 0.5f;
    [SerializeField, Range(3, 20)]
    private int laserBreaks = 15;

    [Header("Laser Switch")]
    [SerializeField]
    private bool switchingLaser = true;
    [SerializeField]
    private float timeOn = 3f;
    [SerializeField]
    private float timeOff = 3f;

    private bool isOn = false;

    [Header("Movement")]
    [SerializeField]
    private bool movingLaser = true;
    [Space]
    [SerializeField]
    private float startSpeed = 2f;
    [SerializeField]
    private float startXDis = 5f;
    [SerializeField]
    private float startYDis = 5f;
    
    [Space]
    [SerializeField]
    private float endSpeed = 2f;
    [SerializeField]
    private float endXDis = 5f;
    [SerializeField]
    private float endYDis = 5f;

    private TranslatingObject startTO;
    private TranslatingObject endTO;

    #endregion

    #region Unity Functions

    void Awake () 
    {
        start = transform.Find("Start");
        end = transform.Find("End");
        audioSrc = GetComponent&lt;AudioSource>();

        if(movingLaser)
        {
            startTO = new TranslatingObject(Mathf.Abs(startSpeed), Mathf.Abs(startXDis), Mathf.Abs(startYDis));
            endTO = new TranslatingObject(Mathf.Abs(endSpeed), Mathf.Abs(endXDis), Mathf.Abs(endYDis));
        }

        line = GetComponent&lt;LineRenderer>();
        if(switchingLaser)
        {
            StartCoroutine(SwitchLaser());
        }
    }
    
    void Update () 
    {
        if(movingLaser)
        {
            start.transform.localPosition = startTO.Move(start.transform.localPosition);
            end.transform.localPosition = endTO.Move(end.transform.localPosition);
        }
        DrawLaser();
    }

    #endregion

    #region Class Methods

    private void DrawLaser()
    {	
        if(isOn)
        {
            line.positionCount = laserBreaks;
            line.SetPosition(0, start.localPosition);
            line.SetPosition(line.positionCount - 1, end.localPosition);
            for (int i = 1; i < line.positionCount - 1; ++i)
            {
                Vector3 newPos = ((float)(line.positionCount - 1 - i) / (float)(line.positionCount - 1)) * start.localPosition + ((float)i / (float)(line.positionCount - 1)) * end.localPosition;
                newPos.x += Random.Range(-laserStrength, laserStrength);
                newPos.y += Random.Range(-laserStrength, laserStrength);
                line.SetPosition(i, newPos);
            }
            CheckLaserHit();
        }
        else
        {
            line.positionCount = 2;
            line.SetPosition(0, Vector2.zero);
            line.SetPosition(1, Vector2.zero);
        }
    }

    private void CheckLaserHit() 
    {
        Vector3 ab = -start.position + end.position;
        hit = Physics2D.Raycast(start.position, ab, ab.magnitude, LayerMask.GetMask("Player"));
        if(hit) 
        {
            AudioManager.Instance.Play("PlayerDeath");
            GameManager.Instance.KillPlayer();
        }
    }

    IEnumerator SwitchLaser()
    {
        while(true)
        {
            float time = isOn ? timeOff : timeOn;
            isOn = !isOn;
            if(isOn)
            {
                audioSrc.Play();	
            }
            else
            {
                audioSrc.Stop();
            }
            yield return new WaitForSeconds(time);
        }
    }

    #endregion
}
										</code></pre>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="single-project-link">
						<a href="./#portfolio" class="project-link prev-project"><i class="fa fa-angle-left"> back to projects</i></a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- single portfolio section end -->
	<footer>
		<div class="container">
			<div class="row">
				<h3>Contact Details</h3>
				<ul class="footer-info">
					<li><i class="fa fa-phone"></i>+52 1 722-4043176</li>
					<li><i class="fa fa-envelope"></i>dev@carlosadan.com<li>
				</ul>
				<div class="social-icon">
					<a href="https://www.linkedin.com/in/carlos-adan-cortes-de-la-fuente-20777356/" target="_blank"><span><i class="fa fa-linkedin" aria-hidden="true"></i></span></a>
					<a href="https://github.com/krlozadan" target="_blank"><span><i class="fa fa-github" aria-hidden="true"></i></span></a>
					<a href="https://twitter.com/krlozadan" target="_blank"><span><i class="fa fa-twitter" aria-hidden="true"></i></span></a>
				</div>
				<img src="./img/game-developer-logo.png" alt="Game Developer Logo">
			</div>
			<!-- ./ Row -->
		</div>
		<!-- ./ Container -->
		<div class="rights">
			<p>©2018 Carlos Adan. All Rights Reserved.</p>
		</div>
	</footer>
	<!-- ======./ Footer ======  -->
	<!-- Optional JavaScript -->
	<script src="./js/jquery-3.1.1.min.js"></script>
	<script src="./js/Migrate.js"></script>
	<script src="./js/bootstrap.min.js"></script>
	<!-- scrollIt js -->
	<script src="./js/scrollIt.min.js"></script>
	<!-- owl carousel js -->
	<script src="./js/owl.carousel.min.js"></script>
	<!-- jquery.counterup.min js -->
	<script src="./js/jquery.counterup.min.js"></script>
	<!-- typed -->
	<script src="./js/typed.js"></script>
	<!-- magnific-popup -->
	<script src="./js/jquery.magnific-popup.min.js"></script>
	<!-- isotope.pkgd.min js -->
	<script src="./js/isotope.pkgd.min.js"></script>
	<!-- jquery.waypoints.min js -->
	<script src="./js/jquery.waypoints.min.js"></script>
	<script src="./js/wow.js"></script>
	<!-- jquery barfiller js -->
	<script src="./js/jquery.barfiller.js"></script>
	<!-- jquery matchHeight -->
	<script src="./js/jquery.matchHeight-min.js"></script>
	<script src="./js/background-effect.js"></script>
	<!-- validator js -->
	<script src="./js/validator.js"></script>
	<!-- ====== gmap3 js ======= -->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJ_mGhah8EApmFiXYYBsdBuygviP2M2EE"></script>
	<script src="./js/gmap3.min.js"></script>
	<!-- ====== Highlight JS ======= -->
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
	<!-- custom JavaScript -->
	<script src="./js/custom.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</body>

</html>